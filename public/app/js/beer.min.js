/* global angular:false */
!function(){"use strict"
angular.module("beerApp",["ngRoute","beerApp.services.BreweryService","beerApp.services.LocationService","beerApp.services.LocationParserService","beerApp.services.QaapiService","beerApp.services.TweetService","beerApp.services.UserModelingService","beerApp.services.MapService","beerApp.services.UmService","beerApp.services.UserModelingService","beerApp.controllers.AnswersController","beerApp.controllers.BreweryBeersController","beerApp.controllers.BrewerySelectedController","beerApp.controllers.BreweryListController","beerApp.controllers.BreweryMapController","beerApp.controllers.QuestionController","beerApp.controllers.TweetController","beerApp.controllers.TweetController","beerApp.controllers.UserModelBuilderController","beerApp.controllers.UserModelResultController","beerApp.directives.slick","beerApp.directives.ladda"]).config(["$routeProvider",function(e){e.when("/home",{templateUrl:"app/partials/home.html"}),e.otherwise({redirectTo:"/home"})}])}(),function(){"use strict"
function e(){return["$scope","$sce",function(e,r){var n
e.$watch(function(){return e.result},function(e){e&&n&&$("slick").slickGoTo(0),n=e}),e.onAfterChange=function(){$('div.answer-container a[href^="http://"]').attr("target","_blank")},e.$on("QaapiService.answers",function(r,n){e.result=n.question}),e.formattedAnswerText=function(n){if(e.result){var t=e.result.answers[n].formattedText
return r.trustAsHtml(t)}}}]}angular.module("beerApp.controllers.AnswersController",["ngRoute"]).controller("AnswersController",e())}(),function(){"use strict"
function e(){return["$scope","BreweryService",function(e,r){e.$on("BreweryMap.selected",function(e,n){r.fetchBeers(n.breweryId)}),e.$on("BreweryListController.selected",function(e,n){r.fetchBeers(n.breweryId)}),e.$on("BreweryService.brewery.beers",function(r,n){e.beers=n.data})
var n=$(window).width()<768?2:3
e.numColumns=n,e.beers=[],e.rows=[],e.cols=[],e.$watch("beers.length",function(){var r=e.beers?e.beers.length:0
e.rows.length=Math.ceil(r/e.numColumns),e.cols.length=e.numColumns})}]}angular.module("beerApp.controllers.BreweryBeersController",["ngRoute"]).controller("BreweryBeersController",e())}(),function(){"use strict"
function e(){return["$scope",function(e){function r(r){e.brewery=r}e.$on("BreweryMap.selected",function(e,n){r(n)}),e.$on("BreweryListController.selected",function(e,n){r(n)})}]}angular.module("beerApp.controllers.BrewerySelectedController",["ngRoute"]).controller("BrewerySelectedController",e())}(),function(){"use strict"
function e(){return["$scope","$rootScope","$http","BreweryService",function(e,r,n,t){e.$on("BreweryService.breweries",function(){var r=t.breweries()&&t.breweries().data
e.data=r.sort(function(e,r){return e.brewery.name<r.brewery.name?-1:e.brewery.name>r.brewery.name?1:0})}),e.notifySelect=function(e,n){r.$broadcast("BreweryListController.selected",n),e.preventDefault()}}]}angular.module("beerApp.controllers.BreweryListController",["ngRoute"]).controller("BreweryListController",e())}(),function(){"use strict"
function e(){var e=null
return["$scope","$http","$rootScope","BreweryService","LocationService","LocationParserService","MapService",function(r,n,t,o,i,a,c){function s(r){e?e.clearMarkers():(e=c.map(document.getElementById("map-canvas")),e.init(d)),$.each(r.data,function(r,n){e.addMarker(n.latitude,n.longitude,l(n),n,u)}),e.fitBounds()}function l(e){return'<div class="mapInfoContainer"><a href="'+e.brewery.website+'" target="_blank">'+e.brewery.name+"</a></div>"}function u(e){t.$broadcast("BreweryMap.selected",e)}function d(e){var r=e.searchText.trim()
a.isState(r.trim())?o.fetchBreweries({region:r.trim()}):i.lookup(r)}r.isLoading=!0,r.$on("BreweryListController.selected",function(n,t){e&&(r.brewery=t,e.selectMarker(t.latitude,t.longitude))}),t.$on("BreweryService.breweries",function(e,n){s(n),r.isLoading=!1}),r.reRender=function(){s(o.breweries())},r.$on("LocationService.location",function(e,r){o.fetchBreweries(r)}),r.$on("LocationService.searching",function(){1==r.isLoading}),i.location()?(e=null,o.fetchBreweries(i.location())):i.locate()}]}angular.module("beerApp.controllers.BreweryMapController",["ngRoute"]).controller("BreweryMapController",e())}(),function(){"use strict"
function e(){return["$scope","QaapiService",function(e,r){e.text="",e.ask=function(n){var t={question:{evidenceRequest:{items:5},formattedAnswer:!0,questionText:n}}
e.isLoading=!0,r.query(t).then(function(){e.isLoading=!1})}}]}angular.module("beerApp.controllers.QuestionController",["ngRoute"]).controller("QuestionController",e())}(),function(){"use strict"
function e(){return["$scope","TweetService",function(e,r){function n(e){r.query(e.brewery.name)}e.$on("TweetService.tweets",function(r,n){e.tweets=n}),e.$on("BreweryMap.selected",function(e,r){n(r)}),e.$on("BreweryListController.selected",function(e,r){n(r)})}]}angular.module("beerApp.controllers.TweetController",["ngRoute"]).controller("TweetController",e())}(),function(){"use strict"
function e(){return["$scope","UserModelingService","UmService",function(e,r,n){e.build=function(){if(!e.$parent.tweets)return void console.log("no profile data")
var t=n.tweetsToProfileData(e.$parent.tweets)
r.profile(t)}}]}angular.module("beerApp.controllers.UserModelBuilderController",["ngRoute"]).controller("UserModelBuilderController",e())}(),function(){"use strict"
function e(){return["$scope","$sce","UserModelingService","UmService",function(e,r,n,t){e.$on("UserModelingService.visualization",function(n,t){e.visualization=r.trustAsHtml(t)}),e.$on("UserModelingService.profile",function(r,o){return o.error_code?void(e.error=o.user_message):(e.analysis=o,e.error=void 0,e.analysisFlat=t.flatten(o.tree),e.analysisKeys=Object.keys(e.analysisFlat),void n.visualize(o))})}]}angular.module("beerApp.controllers.UserModelResultController",["ngRoute"]).controller("UserModelResultController",e())}(),function(){"use strict"
function e(){return["$timeout",function(e){return{restrict:"AEC",scope:{initOnload:"@",data:"=",currentIndex:"=",accessibility:"@",arrows:"@",autoplay:"@",autoplaySpeed:"@",centerMode:"@",centerPadding:"@",cssEase:"@",dots:"@",draggable:"@",easing:"@",fade:"@",infinite:"@",lazyLoad:"@",onBeforeChange:"@",onAfterChange:"@",onInit:"@",onReInit:"@",pauseOnHover:"@",responsive:"&",slide:"@",slidesToShow:"@",slidesToScroll:"@",speed:"@",swipe:"@",touchMove:"@",touchThreshold:"@",vertical:"@"},link:function(r,n){var t,o
return t=function(){return e(function(){var e,t
return t=$(n),null!=r.currentIndex&&(e=r.currentIndex),t.slick({accessibility:"false"!==r.accessibility,arrows:"false"!==r.arrows,autoplay:"true"===r.autoplay,autoplaySpeed:null!=r.autoplaySpeed?parseInt(r.autoplaySpeed,10):3e3,centerMode:"true"===r.centerMode,centerPadding:r.centerPadding||"50px",cssEase:r.cssEase||"ease",dots:"true"===r.dots,draggable:"false"!==r.draggable,easing:r.easing||"linear",fade:"true"===r.fade,infinite:"false"!==r.infinite,lazyLoad:r.lazyLoad||"ondemand",onBeforeChange:r.onBeforeChange||null,onAfterChange:function(n,t){return r.onAfterChange&&r.onAfterChange(),null!=e?r.$apply(function(){return e=t,r.currentIndex=t}):void 0},onInit:function(n){return r.onInit&&r.onInit(),null!=e?n.slideHandler(e):void 0},onReInit:r.onReInit||null,pauseOnHover:"false"!==r.pauseOnHover,responsive:r.responsive()||null,slide:r.slide||"div",slidesToShow:null!=r.slidesToShow?parseInt(r.slidesToShow,10):1,slidesToScroll:null!=r.slidesToScroll?parseInt(r.slidesToScroll,10):1,speed:null!=r.speed?parseInt(r.speed,10):300,swipe:"false"!==r.swipe,touchMove:"false"!==r.touchMove,touchThreshold:r.touchThreshold?parseInt(r.touchThreshold,10):5,vertical:"true"===r.vertical}),r.$watch("currentIndex",function(r){return null!=e&&null!=r&&r!==e?t.slickGoTo(r):void 0})})},r.initOnload?(o=!1,r.$watch("data",function(e){return null==e||o?void 0:(t(),o=!0)})):t()}}}]}angular.module("beerApp.directives.slick",[]).directive("slick",e())}(),function(){"use strict"
function e(){return{restrict:"A",link:function(e,r,n){var t=Ladda.create(r[0])
e.$watch(n.ladda,function(e){e?t.isLoading()||t.start():t.isLoading()&&t.stop()})}}}angular.module("beerApp.directives.ladda",[]).directive("ladda",e)}(),function(){"use strict"
function e(){return["$http","$q","$rootScope",function(e,r,n){function t(r){var n=e({method:"get",url:"/brewery/"+r+"/beers"})
return n.then(a("BreweryService.brewery.beers"),i)}function o(r){var n={},t=r.loc&&r.loc.split(",")
if(t&&2==t.length){n.lat=t[0],n.lng=t[1]
var o=e({method:"get",url:"/breweries/nearby",params:n})
return o.then(a("BreweryService.breweries"),i)}r.city_override&&(n.locality=r.city_override),r.city&&(n.locality=r.city),!r.city&&r.region&&(n.region=r.region)
var o=e({method:"get",url:"/breweries",params:n})
return o.then(a("BreweryService.breweries"),i)}function i(e){return r.reject(angular.isObject(e.data)&&e.data.message?e.data.message:"An unknown error occurred.")}function a(e){return function(r){return l=r.data,n.$broadcast(e,l),l}}function c(){n.$broadcast("BreweryService.breweries",s())}function s(){return l}var l=null
return{fetchBreweries:o,fetchBeers:t,breweries:s,notify:c}}]}angular.module("beerApp.services.BreweryService",[]).factory("BreweryService",e())}(),function(){"use strict"
function e(){return["$http","$q","$rootScope",function(e,r,n){function t(e){var r,t=new google.maps.Geocoder
t.geocode({address:e},function(e){r=e[0].geometry.location.lat()+","+e[0].geometry.location.lng(),n.$broadcast("LocationService.location",{loc:r})})}function o(){if(n.$broadcast("LocationService.searching"),!navigator.geolocation){var r=e.jsonp("http://ipinfo.io?callback=JSON_CALLBACK")
return r.then(a,i)}navigator.geolocation.getCurrentPosition(function(e){n.$broadcast("LocationService.location",{loc:e.coords.latitude+","+e.coords.longitude})},function(){var r=e.jsonp("http://ipinfo.io?callback=JSON_CALLBACK")
return r.then(a,i)})}function i(e){return r.reject(angular.isObject(e.data)&&e.data.message?e.data.message:"An unknown error occurred.")}function a(e){return s=e.data,n.$broadcast("LocationService.location",s),s}function c(){return s}var s=null
return{location:c,locate:o,lookup:t}}]}angular.module("beerApp.services.LocationService",[]).factory("LocationService",e())}(),function(){"use strict"
function e(){return[function(){function e(e){var n=/[0-9]/
if(e=e.trim(),e.match(n))throw Error("number found")
var o=[]
if(e.indexOf(",")>-1){o=e.split(",").map(function(e){return e.trim()})
var i=o[1],a=t[i]
a&&(o[1]=a)}if(0===o.length){var a=r(e)
a?(o.push(void 0),o.push(a)):o.push(e)}return{city:o[0],region:o[1]}}function r(e){var r=t(e)
if(r)return r
var n=o(e.toUpperCase())
return n?e:void 0}function n(e){var r=e.trim().toUpperCase()
return o(r)?!0:!1}function t(e){var r={AL:"Alabama",AK:"Alaska",AS:"American Samoa",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",DC:"District Of Columbia",FM:"Federated States Of Micronesia",FL:"Florida",GA:"Georgia",GU:"Guam",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MH:"Marshall Islands",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",MP:"Northern Mariana Islands",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PW:"Palau",PA:"Pennsylvania",PR:"Puerto Rico",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VI:"Virgin Islands",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"}
return r[e]}function o(e){var r={ALABAMA:"AL",ALASKA:"AK","AMERICAN SAMOA":"AS",ARIZONA:"AZ",ARKANSAS:"AR",CALIFORNIA:"CA",COLORADO:"CO",CONNECTICUT:"CT",DELAWARE:"DE","DISTRICT OF COLUMBIA":"DC","FEDERATED STATES OF MICRONESIA":"FM",FLORIDA:"FL",GEORGIA:"GA",GUAM:"GU",HAWAII:"HI",IDAHO:"ID",ILLINOIS:"IL",INDIANA:"IN",IOWA:"IA",KANSAS:"KS",KENTUCKY:"KY",LOUISIANA:"LA",MAINE:"ME","MARSHALL ISLANDS":"MH",MARYLAND:"MD",MASSACHUSETTS:"MA",MICHIGAN:"MI",MINNESOTA:"MN",MISSISSIPPI:"MS",MISSOURI:"MO",MONTANA:"MT",NEBRASKA:"NE",NEVADA:"NV","NEW HAMPSHIRE":"NH","NEW JERSEY":"NJ","NEW MEXICO":"NM","NEW YORK":"NY","NORTH CAROLINA":"NC","NORTH DAKOTA":"ND","NORTHERN MARIANA ISLANDS":"MP",OHIO:"OH",OKLAHOMA:"OK",OREGON:"OR",PALAU:"PW",PENNSYLVANIA:"PA","PUERTO RICO":"PR","RHODE ISLAND":"RI","SOUTH CAROLINA":"SC","SOUTH DAKOTA":"SD",TENNESSEE:"TN",TEXAS:"TX",UTAH:"UT",VERMONT:"VT","VIRGIN ISLANDS":"VI",VIRGINIA:"VA",WASHINGTON:"WA","WEST VIRGINIA":"WV",WISCONSIN:"WI",WYOMING:"WY"}
return r[e]}return{parse:e,isState:n}}]}angular.module("beerApp.services.LocationParserService",[]).factory("LocationParserService",e())}(),function(){"use strict"
function e(){return["$http","$q","$rootScope",function(e,r,n){function t(r){var n=e({method:"post",headers:{"Content-Type":"application/json"},url:"/question",data:r})
return n.then(i,o)}function o(e){return r.reject(angular.isObject(e.data)&&e.data.message?e.data.message:"An unknown error occurred.")}function i(e){return c=e.data,n.$broadcast("QaapiService.answers",c),c}function a(){return c}var c=null
return{query:t,items:a}}]}angular.module("beerApp.services.QaapiService",[]).factory("QaapiService",e())}(),function(){"use strict"
function e(){return["$http","$q","$rootScope",function(e,r,n){function t(r){var n=e({method:"get",url:"/tweet",params:{q:r,count:100}})
return n.then(i,o)}function o(e){return r.reject(angular.isObject(e.data)&&e.data.message?e.data.message:"An unknown error occurred.")}function i(e){var r=e.data.tweets
return n.$broadcast("TweetService.tweets",r),r}return{query:t}}]}angular.module("beerApp.services.TweetService",[]).factory("TweetService",e())}(),function(){"use strict"
function e(){return["$http","$q","$rootScope",function(e,r,n){function t(r){var n=e({method:"post",headers:{"Content-Type":"application/json"},url:"/um/profile",data:r})
return n.then(a("UserModelingService.profile"),i("UserModelingService.profile"))}function o(r){var n=e({method:"post",headers:{"Content-Type":"application/json"},url:"/um/visualize",data:r})
return n.then(a("UserModelingService.visualization"),i("UserModelingService.visualization"))}function i(e){return function(t){return angular.isObject(t.data)&&t.data.user_message?(n.$broadcast(e,t.data),r.reject(t.data.user_message)):r.reject("An unknown error occurred.")}}function a(e){return function(r){return c=r.data,n.$broadcast(e,c),c}}var c=null
return{profile:t,visualize:o}}]}angular.module("beerApp.services.UserModelingService",[]).factory("UserModelingService",e())}(),function(){"use strict"
function e(){function e(e){var n=[],t={},o=null,i=new google.maps.InfoWindow
return{init:function(n){o=new google.maps.Map(e,{mapTypeId:google.maps.MapTypeId.ROADMAP,navigationControl:!0,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}})
var t=r(o,n)[0]
return t.index=1,o.controls[google.maps.ControlPosition.TOP_LEFT].push(t),o},clearMarkers:function(){for(var e=0;e<n.length;e++)n[e].setMap(null)
n=[],t={}},addMarker:function(e,r,a,c,s){var l=new google.maps.Marker({position:new google.maps.LatLng(e,r),map:o})
google.maps.event.addListener(l,"click",function(e,r){return function(){i.setContent(r),i.open(o,e)}}(l,a)),google.maps.event.addListener(l,"click",function(e){return function(){s(e)}}(c)),l._infoContent=a,n.push(l),t["_"+e+r]=l},fitBounds:function(){for(var e=new google.maps.LatLngBounds,r=0;r<n.length;r++)e.extend(n[r].position)
o.fitBounds(e)},selectMarker:function(e,r){var n=t["_"+e+r]
i.setContent(n._infoContent),i.open(o,n)}}}function r(e,r){var n=$("<div/>").attr({"class":"input-map"}),t=($("<input/>").attr({type:"text",id:"mapInput",name:"mapInput"}).appendTo(n),$("<button/>").attr({type:"button",id:"mapSubmit",name:"mapSubmit","class":"btn-sm btn-primary btn-map"}).text("Search").appendTo(n))
return google.maps.event.addDomListener(t[0],"click",function(e){e.searchText=$("#mapInput").val(),r(e)}),n}return{map:e}}angular.module("beerApp.services.MapService",[]).factory("MapService",e)}(),function(){"use strict"
function e(){function e(e){for(var r,n=function(e){for(var r=400,n=e;n.length<r;)n+=n+" "+n
return n},t=[],o={contentItems:t},i=0;i<e.length;i++)r=e[i],t[i]={contenttype:"text/plain",sourceid:"twitter",userid:"patron",created:new Date(r.created_at).getTime(),language:"en",content:n(r.text),id:r.id_str}
return o}function r(e,r){function n(e){return r.indexOf(e.name)>=0?!0:!0}var t=e,o=function(e){if(e.children)for(var r=0;r<e.children.length;r++){var t=e.children[r]
if(t.children)o(t)
else{var i=e.children.filter(n)
e.children=i}}}
return o(t.tree),t}function n(e){var r={},n=[],t=function(e,o){if(e){if(o>0&&(!e.children||2!==o)){var i={}
i.id=e.id,i.name=e.name,e.children&&(i.title=!0),e.percentage?(i.value=Math.floor(100*e.percentage),n.push(i)):(r[i.id]={name:i.name,arr:[]},n=r[i.id].arr),"sbh"!=e.id}if(e.children&&"sbh"!==e.id)for(var a=0;a<e.children.length;a++)t(e.children[a],o+1)}}
t(e,0)
var o=[r.personality,r.needs,r.values]
return o.forEach(function(e){e.arr.sort(function(e,r){return e.value<r.value?1:-1})}),o}return{tweetsToProfileData:e,filterTraits:r,flatten:n}}angular.module("beerApp.services.UmService",[]).factory("UmService",e)}()
